(function(g,d){"object"===typeof exports?d(exports):"function"===typeof define&&define.amd?define(["exports"],d):d(g)})(this,function(g){function d(a){this._targetElement=a;this._wideAreaId=1;this._options={wideAreaAttr:"data-widearea",exitOnEsc:!0,defaultColorScheme:"light",closeIconLabel:"Close WideArea",changeThemeIconLabel:"Toggle Color Scheme",fullScreenIconLabel:"WideArea Mode",autoSaveKeyPrefix:"WDATA-"};r.call(this)}function n(a,b){localStorage.setItem(this._options.autoSaveKeyPrefix+a,b)}
function r(){var a=this,b=this._targetElement.querySelectorAll("textarea["+this._options.wideAreaAttr+"='enable']"),c=function(){s.call(a,this)};this._textareas=[];for(var f=b.length-1;0<=f;f--){var e=b[f],k=document.createElement("div"),h=document.createElement("div"),d=document.createElement("a");k.className="widearea-wrapper";h.className="widearea-icons";d.className="widearea-icon fullscreen";d.title=this._options.fullScreenIconLabel;d.href="javascript:void(0);";d.draggable=!1;d.onclick=c;e.className=
(e.className+" widearea").replace(/^\s+|\s+$/g,"");e.setAttribute("data-widearea-id",this._wideAreaId);h.setAttribute("id","widearea-"+this._wideAreaId);localStorage.getItem(this._options.autoSaveKeyPrefix+this._wideAreaId)&&(e.value=localStorage.getItem(this._options.autoSaveKeyPrefix+this._wideAreaId));var g=function(){n.call(a,this.getAttribute("data-widearea-id"),this.value)};e.addEventListener?e.addEventListener("input",g,!1):e.attachEvent&&e.attachEvent("onpropertychange",g);++this._wideAreaId;
p(e,h);h.appendChild(d);k.appendChild(h);document.body.appendChild(k);this._textareas.push(e)}this._timer=setInterval(function(){for(var b=a._textareas.length-1;0<=b;b--){var c=a._textareas[b],e=document.getElementById("widearea-"+c.getAttribute("data-widearea-id")),f=l(e),d=l(c);f.left-d.width+21==d.left&&f.top==d.top||p(c,e,d)}},200)}function p(a,b,c){a=c||l(a);b.style.left=a.left+a.width-21+"px";b.style.top=a.top+"px"}function l(a){var b={};b.width=a.offsetWidth;b.height=a.offsetHeight;for(var c=
0,f=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)c+=a.offsetLeft,f+=a.offsetTop,a=a.offsetParent;b.top=f;b.left=c;return b}function s(a){var b=this;a=parseInt(a.parentNode.id.replace(/widearea\-/,""));a=document.querySelector("textarea[data-widearea-id='"+a+"']");var c=a.cloneNode();c.className=("widearea-fullscreen "+a.className).replace(/^\s+|\s+$/g,"");a.className=("widearea-fullscreened "+a.className).replace(/^\s+|\s+$/g,"");var f=document.createElement("div");f.className="widearea-controlPanel";
var e=document.createElement("a");e.href="javascript:void(0);";e.className="widearea-icon close";e.title=this._options.closeIconLabel;e.onclick=function(){q.call(b)};e.draggable=!1;var d=document.createElement("a");d.href="javascript:void(0);";d.className="widearea-icon changeTheme";d.title=this._options.changeThemeIconLabel;d.onclick=function(){t.call(b)};d.draggable=!1;f.appendChild(e);f.appendChild(d);e=document.createElement("div");e.className="widearea-overlayLayer "+this._options.defaultColorScheme;
e.appendChild(c);e.appendChild(f);document.body.appendChild(e);c.focus();c.value=a.value;a=function(){n.call(b,this.getAttribute("data-widearea-id"),this.value)};c.addEventListener?c.addEventListener("input",a,!1):c.attachEvent&&c.attachEvent("onpropertychange",a);this._onKeyDown=function(a){27===a.keyCode&&b._options.exitOnEsc&&q.call(b);9==a.keyCode&&(a.preventDefault(),a=c.selectionStart,c.value=c.value.substring(0,a)+"\t"+c.value.substring(c.selectionEnd),c.selectionEnd=a+1)};window.addEventListener?
window.addEventListener("keydown",b._onKeyDown,!0):document.attachEvent&&document.attachEvent("onkeydown",b._onKeyDown)}function t(){var a=document.querySelector(".widearea-overlayLayer");/dark/gi.test(a.className)?a.className=a.className.replace("dark","light"):a.className=a.className.replace("light","dark")}function q(){var a=document.querySelector("textarea.widearea-fullscreened"),b=document.querySelector(".widearea-overlayLayer"),c=b.querySelector("textarea");a.focus();a.value=c.value;a.className=
a.className.replace(/widearea-fullscreened/gi,"").replace(/^\s+|\s+$/g,"");b.parentNode.removeChild(b);window.removeEventListener?window.removeEventListener("keydown",this._onKeyDown,!0):document.detachEvent&&document.detachEvent("onkeydown",this._onKeyDown)}var m=function(a){if("string"===typeof a){if(a=document.querySelector(a))return new d(a);throw Error("There is no element with given selector.");}return new d(document.body)};m.version="0.3.0";m.fn=d.prototype={clone:function(){return new d(this)},
setOption:function(a,b){this._options[a]=b;return this},setOptions:function(a){var b=this._options,c={},d;for(d in b)c[d]=b[d];for(d in a)c[d]=a[d];this._options=c;return this},clearData:function(a){var b,c;"string"==typeof a?(b=this._targetElement.querySelector(a))&&(c=parseInt(b.getAttribute("data-widearea-id"))):"number"==typeof a?(b=this._targetElement.querySelector('textarea[data-widearea-id="'+a+'"]'),c=a):"object"==typeof a&&(b=a)&&(c=parseInt(b.getAttribute("data-widearea-id")));b&&c&&(b.value=
"",localStorage.removeItem(this._options.autoSaveKeyPrefix+c));return this}};return g.wideArea=m});
